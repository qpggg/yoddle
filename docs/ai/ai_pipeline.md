### Цель
Сформировать замкнутый AI‑контур: от корпоративных данных к измеримой «карте вовлечённости» и умным рекомендациям бенефитов и активностей.

### Поток (по слайду)
- **Корпоративные данные**: календари, CRM‑логи, опросы, льготы, оргструктура
- → **Карта вовлечённости**: сильные/слабые стороны, настроение, рейтинг, интегральный индекс вовлечённости
- → **Умные рекомендации**: персональные (например, «массаж и спорт»), групповые («командные активности»)

### Источники и интеграции
- **Календари**: события, плотность встреч, внерабочие митинги, overtime
- **CRM‑логи**: объём коммуникаций, win/loss, нагрузка (по ролям), SLA
- **Опросы**: eNPS, настроение, стрессы, темы
- **Льготы**: каталог, использование, цены, остаток кошелька
- **Оргструктура**: подразделения, руководители, кросс‑связи

### Карта вовлечённости (фичи)
- **Индивидуальные**: индекс стресса, баланс день/неделя, контекстные пики загрузки, стабильность настроения
- **Командные**: дисбаланс встреч, провалы настроения, выгорание по ролям
- **Категории сильных/слабых сторон**: здоровье, спорт, обучение, психологическая поддержка, соц. активности
- **Итоговые метрики**: вовлечённость %, риск выгорания, рекомендации приоритетов

### Модельный стек (MVP → масштабирование)
- **Sentiment/Topic**: sentiment + темы из опросов (ru‑bert + rules), токсичность/стресс‑лексика
- **Аномалии**: из календаря/CRM временные отклонения (robust z‑score, Prophet)
- **Рекомендательная модель**: hybrid (content‑based + rules), затем matrix factorization/LightFM
- **Групповые инсайты**: агрегирование фичей по оргструктуре + сигналы для HR/лидов

### API (MVP)
- `POST /api/ai/ingest` — приём батчей сигналов (normalized JSON)
- `GET /api/ai/engagement?user_id=` — карта вовлечённости (фичи + индекс)
- `GET /api/ai/recommendations?user_id=&limit=` — список рекомендаций (льготы/активности)
- `GET /api/ai/insights?team_id=` — командные сигналы и «что делать»

### Схема БД (минимум)
- `ai_signals(id, user_id, source, ts, payload jsonb)`
- `ai_features(user_id, ts, engagement_score, stress_score, mood_score, strengths jsonb, weaknesses jsonb)`
- `ai_recommendations(user_id, benefit_id, score, reason, created_at)`
- `ai_team_insights(team_id, ts, insight_type, payload jsonb)`

### Алгоритм расчёта (ежечасно/ежедневно)
1) ETL: собрать новые сигналы → нормализовать → `ai_signals`
2) Фичи: агрегировать окнами (1д/7д/30д) → `ai_features`
3) Модели: sentiment/аномалии → комбинировать в индекс вовлечённости
4) Рекомендации: 
   - правила (если «сидячий режим» → «массаж/спорт»)
   - контент‑сходство (профиль пользователя ↔ бенефиты)
   - budget‑aware (учёт баланса, цен, лимитов)
5) Запись в `ai_recommendations`, публикация в `/api/ai/recommendations`

### Интеграция с кошельком
- Фильтровать рекомендации по балансу и цене (`price_coins ≤ balance`)
- Логировать принятые рекомендации как события для обучения
- Замыкать цикл: принятие → эффект на фичи/настроение → переобучение правил/весов

### Метрики
- **Accuracy рекомендации**: CTR/accept rate
- **Влияние**: Δ вовлечённости, Δ настроения, снижение выгорания
- **Бизнес**: использование льгот, NPS HR/сотрудников

### Безопасность/конфиденциальность
- Минимизация полей, псевдонимизация user_id
- Аудит‑лог обращений к AI
- Rate limits и отладочные флаги

### Поэтапно (2 недели MVP)
- Дни 1‑2: схему БД + ETL каркасы (`/api/ai/ingest`)
- Дни 3‑5: расчёт фич/индекс вовлечённости (`/api/ai/engagement`)
- Дни 6‑8: правила рекомендаций + интеграция с кошельком (`/api/ai/recommendations`)
- Дни 9‑10: командные инсайты + UI‑виджеты
- Дни 11‑12: метрики, алерты, шлифовка
- Дни 13‑14: документация, демонстрация кейсов
