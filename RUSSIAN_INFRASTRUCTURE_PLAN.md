# 🇷🇺 ПЛАН ИНФРАСТРУКТУРЫ YODDLE (РОССИЙСКИЕ ЦЕНЫ)

## 🎯 ЦЕЛЬ: 20,000 ПОЛЬЗОВАТЕЛЕЙ НА РОССИЙСКИХ СЕРВЕРАХ

### 🖥️ **АНАЛИЗ РОССИЙСКИХ СЕРВЕРОВ**

По предоставленным ценам:
- **Джун (1 CPU, 0.5GB RAM):** 190₽/месяц
- **Джун+ (1 CPU, 1GB RAM):** 360₽/месяц  
- **Мидл (2 CPU, 2GB RAM):** 790₽/месяц
- **Мидл+ (2 CPU, 4GB RAM):** 1,590₽/месяц
- **Сеньор (4 CPU, 6GB RAM):** 2,390₽/месяц
- **Сеньор+ (6 CPU, 8GB RAM):** 3,990₽/месяц

## 📊 **РАСЧЕТ НАГРУЗКИ ДЛЯ 20,000 ПОЛЬЗОВАТЕЛЕЙ**

### Ожидаемая нагрузка:
- **20,000 пользователей** = ~2,000 одновременных
- **API запросы:** ~1,000 RPS
- **База данных:** ~2,000 запросов/сек
- **Память:** ~16-24 GB
- **CPU:** ~12-16 ядер

### Вывод: Нужно минимум 2-3 сервера!

## 🏗️ **РЕКОМЕНДУЕМАЯ АРХИТЕКТУРА**

### Вариант 1: Бюджетный (2 сервера)
```
┌─────────────────────────────────────┐
│           СЕРВЕР 1                  │
│  Сеньор+ (6 CPU, 8GB RAM)          │
│  - Nginx (Reverse Proxy)            │
│  - Node.js API (3 процесса)         │
│  - PostgreSQL (основная БД)         │
│  - Redis (кэш + сессии)             │
│  Стоимость: 3,990₽/месяц            │
└─────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────┐
│           СЕРВЕР 2                  │
│  Сеньор+ (6 CPU, 8GB RAM)          │
│  - Node.js API (3 процесса)         │
│  - PostgreSQL (реплика)             │
│  - Static Files (React build)       │
│  - Мониторинг                       │
│  Стоимость: 3,990₽/месяц            │
└─────────────────────────────────────┘
```

### Вариант 2: Оптимальный (3 сервера)
```
┌─────────────────────────────────────┐
│           СЕРВЕР 1                  │
│  Сеньор+ (6 CPU, 8GB RAM)          │
│  - Nginx (Load Balancer)            │
│  - Node.js API (2 процесса)         │
│  - Мониторинг + Логи                │
│  Стоимость: 3,990₽/месяц            │
└─────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────┐
│           СЕРВЕР 2                  │
│  Сеньор+ (6 CPU, 8GB RAM)          │
│  - Node.js API (2 процесса)         │
│  - PostgreSQL (основная БД)         │
│  - Redis (кэш)                      │
│  Стоимость: 3,990₽/месяц            │
└─────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────┐
│           СЕРВЕР 3                  │
│  Сеньор+ (6 CPU, 8GB RAM)          │
│  - Node.js API (2 процесса)         │
│  - PostgreSQL (реплика)             │
│  - Static Files (React build)       │
│  Стоимость: 3,990₽/месяц            │
└─────────────────────────────────────┘
```

## 💰 **ДЕТАЛЬНЫЙ РАСЧЕТ СТОИМОСТИ**

### Вариант 1: Бюджетный (2 сервера)
- **Сервер 1 (Сеньор+):** 3,990₽/месяц
- **Сервер 2 (Сеньор+):** 3,990₽/месяц
- **CDN (Cloudflare Pro):** 1,500₽/месяц
- **Backup storage:** 500₽/месяц
- **Домен + SSL:** 200₽/месяц
- **Мониторинг:** 0₽ (бесплатный план)

**ИТОГО: 10,180₽/месяц** ≈ $110/месяц

### Вариант 2: Оптимальный (3 сервера)
- **Сервер 1 (Сеньор+):** 3,990₽/месяц
- **Сервер 2 (Сеньор+):** 3,990₽/месяц
- **Сервер 3 (Сеньор+):** 3,990₽/месяц
- **CDN (Cloudflare Pro):** 1,500₽/месяц
- **Backup storage:** 500₽/месяц
- **Домен + SSL:** 200₽/месяц
- **Мониторинг:** 0₽ (бесплатный план)

**ИТОГО: 14,170₽/месяц** ≈ $155/месяц

## 📈 **СРАВНЕНИЕ ВАРИАНТОВ**

| Параметр | Вариант 1 (2 сервера) | Вариант 2 (3 сервера) |
|----------|----------------------|----------------------|
| Стоимость | 10,180₽/месяц | 14,170₽/месяц |
| Надежность | 95% | 99.5% |
| Производительность | Хорошая | Отличная |
| Масштабируемость | До 30K пользователей | До 50K пользователей |
| Время отклика | <300ms | <200ms |

## 🚀 **ПЛАН РЕАЛИЗАЦИИ**

### Этап 1: Бюджетный вариант (1 месяц)
1. **Неделя 1-2:** Исправление критических проблем API/БД
2. **Неделя 3:** Настройка 2 серверов
3. **Неделя 4:** Тестирование и оптимизация

### Этап 2: Масштабирование (при необходимости)
1. Добавление 3-го сервера
2. Настройка репликации БД
3. Улучшение балансировки нагрузки

## 🔧 **ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ**

### Оптимизация для российских серверов:
```javascript
// PM2 конфигурация для 2 серверов
module.exports = {
  apps: [{
    name: 'yoddle-api',
    script: 'server.js',
    instances: 3, // 3 процесса на сервер
    exec_mode: 'cluster',
    max_memory_restart: '1.5G', // 8GB RAM / 3 процесса
    env: {
      NODE_ENV: 'production'
    }
  }]
}
```

### Оптимизация PostgreSQL:
```sql
-- Настройки для 8GB RAM
shared_buffers = 2GB
effective_cache_size = 6GB
work_mem = 32MB
maintenance_work_mem = 512MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
```

## 🎯 **РЕКОМЕНДАЦИЯ**

**Начинать с Варианта 1 (2 сервера):**
- Достаточно для 20,000 пользователей
- Бюджетный вариант
- Возможность масштабирования
- Быстрый запуск

**Переходить на Вариант 2 при:**
- >30,000 пользователей
- Время отклика >300ms
- Нагрузка >1,500 RPS

## 💡 **ЭКОНОМИЯ**

**По сравнению с зарубежными серверами:**
- **Экономия:** 70-80%
- **Латентность:** -50% (для российских пользователей)
- **Соответствие законам:** 100% (152-ФЗ)

**Готов к реализации! 🚀** 